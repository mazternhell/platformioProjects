; PlatformIO Project Configuration File - OPTIMIZED
; ESP32-S3 Hydroponics Controller - Aggressive Optimization
;
; Optimizations applied:
; - Compiler optimization level (-Os for size)
; - Debug level control
; - LTO (Link Time Optimization)
; - Strip debug symbols

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Serial Monitor
monitor_speed = 115200
monitor_port = COM10
monitor_rts = 1
monitor_dtr = 1
monitor_filters = 
    default
    esp32_exception_decoder
    colorize
    send_on_enter
monitor_echo = yes
monitor_eol = CRLF
monitor_raw = no

; Upload
upload_speed = 921600
;upload_flags = 
;    --before=default_reset  ; Use DTR/RTS for reset before upload
;    --after=hard_reset      ; Hard reset after upload

; Hardware: N16R8 (16MB Flash, 8MB PSRAM)
board_build.flash_size = 16MB
board_build.flash_mode = dio
board_build.filesystem = littlefs
; NO custom partition table - use defaults!

; OPTIMIZATION FLAGS
build_flags = 
    ; Debug level control (0=None, 1=Error, 2=Info, 3=Verbose)
    -DDEBUG_LEVEL=1
    
    ; Compiler optimizations
    ;-Os                          ; Optimize for size
    ;-ffunction-sections          ; Each function in its own section
    ;-fdata-sections              ; Each data in its own section
    
    ; Core settings
    -DCORE_DEBUG_LEVEL=1         
    ;-DARDUINO_USB_MODE=1
    ;-DARDUINO_USB_CDC_ON_BOOT=1
    
; Linker optimizations (LTO removed - incompatible with toolchain)
build_unflags = 
    -DCORE_DEBUG_LEVEL=5         ; Remove verbose debug

; Link optimization without LTO
board_build.extra_flags =
    -Wl,--gc-sections            ; Remove unused sections

; Libraries for hydroponics controller
lib_deps = 
    ;tzapu/WiFiManager@^2.0.16-rc.2
    knolleary/PubSubClient@^2.8
    adafruit/RTClib@^2.1.1
    bblanchon/ArduinoJson@^6.21.3
    adafruit/Adafruit NeoPixel@^1.11.0
    adafruit/Adafruit GFX Library@^1.12.3
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git
    marvinroger/AsyncMqttClient @ ^0.9.0
    me-no-dev/ESPAsyncTCP @ ^1.2.2